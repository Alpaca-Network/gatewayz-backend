[phases.setup]
nixPkgs = ['python312']

[phases.install]
# Install ONLY from requirements.txt, ignore pyproject.toml to avoid test dependencies (playwright)
cmds = [
  'echo "Cache bust: 2026-01-19-v1"',
  'rm -rf /opt/venv',
  'python -m venv --copies /opt/venv',
  '. /opt/venv/bin/activate && pip install --no-cache-dir --no-deps -r requirements.txt || true',
  '. /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt'
]

[phases.build]
cmds = [
  '. /opt/venv/bin/activate && pip install --no-cache-dir --force-reinstall httpx==0.27.0 openai==1.44.0',
  '. /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt'
]

[start]
cmd = 'bash start.sh'
