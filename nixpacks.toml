[phases.setup]
nixPkgs = ['python312']

[phases.install]
cmds = [
  'echo "Cache bust: 2026-02-11-v3-revert-otel-instrumentation"',
  'rm -rf /opt/venv',
  'python -m venv --copies /opt/venv',
  '. /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt'
]

[phases.build]
cmds = [
  '. /opt/venv/bin/activate && pip install --no-cache-dir --force-reinstall httpx==0.27.0 openai==1.44.0',
  '. /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt'
]

[start]
cmd = 'bash start.sh'
