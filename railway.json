{
  "$schema": "https://railway.app/railway.schema.json",
  "services": [
    {
      "name": "gateway-api",
      "build": {
        "builder": "NIXPACKS"
      },
      "deploy": {
        "startCommand": "uvicorn src.main:app --host 0.0.0.0 --port $PORT --workers 1",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10,
        "healthchecks": {
          "liveness": {
            "enabled": true,
            "interval": 30,
            "timeout": 10,
            "initialDelay": 30,
            "path": "/health"
          },
          "readiness": {
            "enabled": true,
            "interval": 10,
            "timeout": 5,
            "initialDelay": 10,
            "path": "/health"
          }
        },
        "environments": {
          "production": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 10,
                "initialDelay": 60
              }
            }
          },
          "staging": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 10,
                "initialDelay": 30
              }
            }
          }
        }
      }
    },
    {
      "name": "health-service",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "health-service/Dockerfile"
      },
      "deploy": {
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 5,
        "healthchecks": {
          "liveness": {
            "enabled": true,
            "interval": 60,
            "timeout": 30,
            "initialDelay": 120,
            "path": "/health"
          },
          "readiness": {
            "enabled": true,
            "interval": 30,
            "timeout": 15,
            "initialDelay": 90,
            "path": "/health"
          }
        },
        "environments": {
          "production": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 60,
                "timeout": 30,
                "initialDelay": 180
              }
            }
          },
          "staging": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 60,
                "timeout": 30,
                "initialDelay": 120
              }
            }
          }
        }
      }
    },
    {
      "name": "apidog-runner",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile.apidog"
      },
      "deploy": {
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 5,
        "healthchecks": {
          "liveness": {
            "enabled": true,
            "interval": 30,
            "timeout": 10,
            "initialDelay": 40
          }
        },
        "environments": {
          "production": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 10,
                "initialDelay": 60
              }
            }
          },
          "staging": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 10,
                "initialDelay": 40
              }
            }
          }
        }
      }
    }
  ]
}
