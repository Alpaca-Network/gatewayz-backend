{
  "$schema": "https://railway.app/railway.schema.json",
  "services": [
    {
      "name": "gateway-api",
      "build": {
        "builder": "NIXPACKS"
      },
      "deploy": {
        "startCommand": "bash start.sh",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10,
        "healthchecks": {
          "liveness": {
            "enabled": true,
            "interval": 30,
            "timeout": 60,
            "initialDelay": 60,
            "path": "/health/railway"
          },
          "readiness": {
            "enabled": true,
            "interval": 10,
            "timeout": 60,
            "initialDelay": 45,
            "path": "/health/railway"
          }
        },
        "requestTimeout": 1800,
        "environments": {
          "production": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 30,
                "initialDelay": 60
              }
            }
          },
          "staging": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 30,
                "initialDelay": 45
              }
            }
          }
        }
      }
    },
    {
      "name": "health-service",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile.health",
        "context": "."
      },
      "deploy": {
        "startCommand": "python /app/health-service/main.py",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 5,
        "healthchecks": {
          "liveness": {
            "enabled": true,
            "interval": 60,
            "timeout": 30,
            "initialDelay": 180,
            "path": "/health"
          },
          "readiness": {
            "enabled": true,
            "interval": 30,
            "timeout": 15,
            "initialDelay": 180,
            "path": "/health"
          }
        },
        "environments": {
          "production": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 60,
                "timeout": 30,
                "initialDelay": 180
              }
            }
          },
          "staging": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 60,
                "timeout": 30,
                "initialDelay": 120
              }
            }
          }
        }
      }
    },
    {
      "name": "apidog-runner",
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile.apidog"
      },
      "deploy": {
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 5,
        "healthchecks": {
          "liveness": {
            "enabled": true,
            "interval": 30,
            "timeout": 10,
            "initialDelay": 40
          }
        },
        "environments": {
          "production": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 10,
                "initialDelay": 60
              }
            }
          },
          "staging": {
            "replicas": 1,
            "healthChecks": {
              "liveness": {
                "enabled": true,
                "interval": 30,
                "timeout": 10,
                "initialDelay": 40
              }
            }
          }
        }
      }
    }
  ]
}
